create or replace database our_first_db;
use our_first_db;
create or replace stage 
manage_db.external_stages.jsonstage
url='s3://mydemo637734'
credentials=(aws_key_id='your id'
aws_secret_key='your secret key');
list @manage_db.external_stages.jsonstage;
-- crete schema inside manage_db
create or replace schema manage_db.file_formats;
-- create a fileformat fro json file
create or replace file format manage_db.file_formats.json_format
type=JSON;

-- varient ata type=> store any type of data

-- stage ius jsonsatge fielformat jason format table=> json_raw
create or replace table our_first_db.public.json_raw( raw_file variant);

copy into our_first_db.public.json_raw
from @manage_db.external_stages.jsonstage
file_format=manage_db.file_formats.json_format
files=('HR_data (2) (1).json');

select * from our_first_db.public.json_raw;

select raw_file,raw_file:city,raw_file:first_name from our_first_db.public.json_raw;

-- if we want chnage data type write this
select raw_file,raw_file:city::string,raw_file:first_name from our_first_db.public.json_raw;
-- type of way to accses coliumn
select raw_file:first_name::string as first_name from our_first_db.public.json_raw;

select raw_file:id::int as id from our_first_db.public.json_raw;

select 
    raw_file:id::int as id,
    raw_file:first_name::string as first_name,
    raw_file:last_name::string as last_name,
    raw_file:gender::string as gender
from our_first_db.public.json_raw;

select raw_file,raw_file:prev_company asprev_company
from our_first_db.public.json_raw;
-- to exrract data from prev_company
select raw_file:prev_company[0]::string as prev_company
from our_first_db.public.json_raw;

-- aray size
-- use union
select 
    raw_file:id::int as id,
    raw_file:first_name::string as first_name,
    raw_file:prev_company[0]::string as prev_company
from our_first_db.public.json_raw

union all

select
    raw_file:id::int as id,
    raw_file:first_name::string as first_name,
    raw_file:prev_company[1]::string as prev_company
from our_first_db.public.json_raw

order by id;

-- by languges
select
    raw_file:first_name::string as first_name,
    raw_file:spoken_languages[0].language::string as first_language,
    raw_file:spoken_languages[0].level::string as level_spoken
from our_first_db.public.json_raw;


